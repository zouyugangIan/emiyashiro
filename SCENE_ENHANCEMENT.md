# 場景增強系統

## 🎨 問題

2D 遊戲場景過於單調，只有：
- 灰色地面
- 少量雲彩
- 單一背景色

## ✨ 解決方案

創建了一個全新的**場景裝飾系統**，添加多層視覺元素！

## 🌟 新增功能

### 1. 多層視差背景 (Parallax Background)

**效果**: 不同層級以不同速度移動，創造深度感

**層級結構**:
```
遠景層 (z = -10.0) - 20% 速度
  └─ 使用封面圖片作為遠景山脈/建築
  
中景層 (z = -7.0) - 50% 速度
  └─ 雲彩（半透明）
  
近景層 (z = -3.0) - 80% 速度
  └─ 雲彩（不透明）
  
地面層 (z = 0.5) - 100% 速度
  └─ 草、石頭、小樹等裝飾物
```

### 2. 增強雲彩系統

**改進**:
- ✅ 更頻繁生成（每 3 秒一朵）
- ✅ 隨機大小（0.6 - 1.2 倍）
- ✅ 隨機透明度（0.5 - 1.0）
- ✅ 多層級（近景和中景）
- ✅ 不同速度（視差效果）

### 3. 地面裝飾物

**類型**:
- 🌱 **草**: 綠色，20x30 像素
- 🪨 **石頭**: 灰色，15x15 像素
- 🌳 **小樹**: 深綠色，10x40 像素

**生成**: 每 2 秒隨機生成一個

### 4. 動態光照效果

**效果**: 遠景背景會隨時間緩慢變亮變暗，模擬日光變化

**週期**: 約 60 秒一個完整循環

## 📁 文件結構

```
src/systems/scene_decoration.rs
├── SceneDecoration 組件
├── DecorationLayer 枚舉
├── setup_parallax_background() - 設置多層背景
├── spawn_enhanced_clouds() - 生成增強雲彩
├── spawn_ground_decorations() - 生成地面裝飾
├── move_scene_decorations() - 視差移動
├── cleanup_offscreen_decorations() - 清理離屏物體
├── loop_far_background() - 遠景循環
└── dynamic_lighting() - 動態光照
```

## 🎮 系統註冊

### OnEnter(GameState::Playing)
```rust
setup_parallax_background  // 初始化多層背景
```

### Update (Playing 狀態)
```rust
spawn_enhanced_clouds           // 生成雲彩
spawn_ground_decorations        // 生成地面裝飾
move_scene_decorations          // 視差移動
cleanup_offscreen_decorations   // 清理
loop_far_background             // 遠景循環
dynamic_lighting                // 動態光照
```

## 🎯 視覺效果

### 視差效果示例

```
玩家移動 100 像素時：

遠景層移動: 20 像素  (慢)  ←────
中景層移動: 50 像素        ←──────
近景層移動: 80 像素        ←────────
地面層移動: 100 像素 (快)  ←──────────
```

### 深度感

```
遠景 (模糊、慢、半透明)
  ↓
中景 (清晰、中速)
  ↓
近景 (清晰、快速)
  ↓
地面 (最清晰、最快)
  ↓
玩家
```

## 🎨 使用的資源

### 遠景背景
- `images/ui/cover10.jpg`
- `images/ui/cover11.jpg`
- `images/ui/cover12.jpg`

### 雲彩
- `images/cloud/cloud01.png`
- `images/cloud/cloud02.png`

### 地面裝飾
- 程序化生成（彩色矩形）

## 🔧 可調參數

### 速度
```rust
const BASE_SPEED: f32 = 50.0;  // 基礎移動速度

FarBackground:   20% (10 px/s)
MidBackground:   50% (25 px/s)
NearBackground:  80% (40 px/s)
Ground:         100% (50 px/s)
```

### 生成頻率
```rust
雲彩: 每 3 秒
地面裝飾: 每 2 秒
```

### 大小範圍
```rust
雲彩: 0.6 - 1.2 倍
地面裝飾: 固定大小
```

## 📊 性能考慮

### 實體管理
- ✅ 自動清理離屏物體
- ✅ 遠景背景循環使用（不清理）
- ✅ 限制生成頻率

### 預期實體數量
```
遠景背景: 3 個（固定）
雲彩: 約 10-15 個
地面裝飾: 約 5-10 個
總計: 約 20-30 個裝飾實體
```

## 🎮 遊戲體驗提升

### 之前
- ❌ 單調的灰色背景
- ❌ 缺乏深度感
- ❌ 視覺疲勞

### 之後
- ✅ 豐富的多層背景
- ✅ 明顯的深度感
- ✅ 動態變化的場景
- ✅ 更有沉浸感

## 🚀 未來擴展建議

1. **添加更多裝飾類型**
   - 鳥類飛行
   - 蝴蝶
   - 落葉效果

2. **天氣系統**
   - 雨天效果
   - 雪花
   - 霧氣

3. **時間系統**
   - 白天/黑夜循環
   - 日出/日落效果

4. **互動元素**
   - 可破壞的裝飾物
   - 收集品

5. **使用真實圖片**
   - 替換程序化地面裝飾為真實圖片
   - 添加更多背景圖片變化

## 📝 總結

場景增強系統通過多層視差背景、動態雲彩和地面裝飾，將單調的 2D 場景轉變為豐富、有深度的遊戲世界！

現在你的遊戲場景充滿生機和動感！🎮✨
